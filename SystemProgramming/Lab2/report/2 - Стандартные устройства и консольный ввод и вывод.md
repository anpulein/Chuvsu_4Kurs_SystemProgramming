<div>
<p align="center" style="font-size=14pt; font-weight: bolder;">МИНИСТЕРСТВО НАУКИ И ВЫСШЕГО ОБРАЗОВАНИЯ РОССИЙСКОЙ ФЕДЕРАЦИИ
<br>
Федеральное государственное бюджетное учреждение высшего образования
<br>
«Чувашский государственный университет И.Н. Ульянова»
<br>
Факультет информатики и вычислительной техники 
<br>
Кафедра вычислительной техники
<br> <br> <br> <br> <br> <br> <br><br> <br> <br>
Системное программирование
<br>
Лабораторная работа 2
<br>
«Стандартные устройства и консольный ввод и вывод»
</p>

<br> <br> <br> <br><br> <br><br>

<span>
<p align="right" style="font-size=14pt; font-weight: bolder;">Выполнил:</p>
<p align="right" style="font-size=14pt;">Студент группы ИВТ-41-20 <br>
Галкин Д.С.
</p>
</span> <br>

<span>
<p align="right" style="font-size=14pt; font-weight: bolder;">Проверил:</p>
<p align="right" style="font-size=14pt;">Яковлев С.B.</p>
</span>

<br> <br>
<br> <br>
<br> <br>
<br> <br>
<p align="center" style="font-size=10pt;">Чебоксары, 2024</p>
<div style="page-break-after:always;  visibility:hidden"></div>
</div>

### Цель работы:

Создать пустое консольное приложение и добавить к нему служебные функции:
1. **PrintString**: записывает сообщения в дескриптор вывода, в заданный обработчиком открытого файла и имеет список параметров переменной длины, задающих адреса строк сообщений (список параметров переменной длины обрабатывается функциями стандартной библиотеки C va_start(), va_arg(), va_end())
```cpp
BOOL PrintStrings(HANDLE hOut, ...);
```
2. **ConsolePrompt**: Выдает пользователю приглашение и возвращает его ответ, параметр Echo дублирует ответ на экран
```cpp
BOOL ConsolePrompt(LPCTSTR pPromptMsg, LPTSTR pResponse, DWORD MaxTchar, BOOL Echo);
BOOL PrintMsg(HANDLE hOut, LPCTSTR pMsg)
```
3. Проверьте работоспособность функций **PrintStrings**, **PrintMsg**, **ConsolePrompt** путем разработки и выполнения тестовой программы на базе пустого консольного приложения
4. Проверьте, подавляется ли эхо клавиатуры в функции **ConsolePrompt**, применив ее для ввода и подтверждения пароля.
<div style="page-break-after:always;  visibility:hidden"></div>
### Полный текст программы:

console_utils.h
```cpp
//  
// Created by Dmitry Galkin on 07.02.2024.  
//  
  
#ifndef CONSOLE_UTILS_H  
#define CONSOLE_UTILS_H  
  
#include <iostream>  
#include <string>  
#include <stdarg.h> // Для работы с переменным числом аргументов  
  
// Объявление функции для вывода строк  
bool PrintStrings(std::ostream& out, ...);  
  
// Объявление функции для вывода приглашения и чтения ответа  
bool ConsolePrompt(const std::string& promptMsg, std::string& response, size_t maxLen, bool echo);  
  
// Объявление функции для вывода одного сообщения  
bool PrintMsg(std::ostream& out, const std::string& msg);  
  
#endif //CONSOLE_UTILS_H
```

<div style="page-break-after:always;  visibility:hidden"></div>

Lab1.cpp
```cpp
//  
// Created by Dmitry Galkin on 07.02.2024.  
//  
#include "console_utils.h"  
#include <iostream>  
#include <string>  
#include <stdarg.h>  
#include <termios.h>  
#include <unistd.h>  
  
bool PrintStrings(std::ostream& out, ...) {  
    va_list args;  
    va_start(args, out);  
    const char* str;  
    while ((str = va_arg(args, const char*)) != nullptr) {  
        if (out.fail()) {  
            va_end(args);  
            return false; // В случае ошибки ввода/вывода возвращаем false  
        }  
        out << str;  
    }  
    va_end(args);  
    return !out.fail(); // Проверяем, не произошла ли ошибка ввода/вывода  
}  
  
bool ConsolePrompt(const std::string& promptMsg, std::string& response, size_t maxLen, bool echo) {  
    struct termios oldt, newt;  
  
    std::cout << promptMsg;  
    if (!echo) {  
        tcgetattr(STDIN_FILENO, &oldt);  
        newt = oldt;  
        newt.c_lflag &= ~ECHO;  
        tcsetattr(STDIN_FILENO, TCSANOW, &newt);  
    }  
  
    std::getline(std::cin, response);  
    if (response.length() > maxLen) {  
        response = response.substr(0, maxLen); // Обрезаем строку, если она слишком длинная  
    }  
  
    if (!echo) {  
        tcsetattr(STDIN_FILENO, TCSANOW, &oldt);  
    }  
    return !std::cin.fail(); // Проверяем, не произошла ли ошибка ввода  
}  
  
bool PrintMsg(std::ostream& out, const std::string& msg) {  
    out << msg << std::endl;  
    return !out.fail(); // Проверяем, не произошла ли ошибка ввода/вывода  
}
```


main.cpp
```cpp
#include "Lab2/console_utils.h"  
#include <iostream>  
#include <vector>  
#include <sys/termios.h>  
  
using namespace std; 
  
void start_lab2();  
  
int main() {  
  
    start_lab2();  
    return 0;  
}
  
  
void start_lab2() {  
    PrintMsg(std::cout, "Тестирование PrintMsg\n");  
    PrintStrings(std::cout, "PrintStrings ", "с ", "проверкой ", "ошибок\n", nullptr);  
  
    std::string response;  
    if (ConsolePrompt("Введите что-нибудь (с эхо): ", response, 256, true)) {  
        PrintMsg(std::cout, "Вы ввели: " + response);  
    } else {  
        PrintMsg(std::cout, "Ошибка ввода.");  
    }  
  
    if (ConsolePrompt("Введите пароль (без эхо): ", response, 256, false)) {  
        PrintMsg(std::cout, "\nПароль успешно введен: " + response);  
    } else {  
        PrintMsg(std::cout, "Ошибка ввода.");  
    }  
  
}
```

<div style="page-break-after:always;  visibility:hidden"></div>

### Пример работы:

![[CleanShot 2024-02-07 at 14.43.49@2x.png]]
